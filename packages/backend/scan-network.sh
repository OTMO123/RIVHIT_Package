#!/bin/bash

echo "=== Сканирование сети 192.168.14.0/24 ==="
echo "Ищем активные устройства..."
echo ""

# Попробуем найти принтер среди активных устройств
echo "Активные IP адреса в вашей сети:"
for ip in $(arp -a | grep "192.168.14" | grep -v incomplete | awk '{print $2}' | tr -d '()'); do
    echo -n "Проверяем $ip... "
    # Проверяем порт 9100 (стандартный порт для принтеров)
    nc -z -w 1 $ip 9100 2>/dev/null
    if [ $? -eq 0 ]; then
        echo "✅ Порт 9100 открыт (возможно принтер!)"
    else
        echo "порт 9100 закрыт"
    fi
done

echo ""
echo "=== Проверка конкретных IP для принтеров ==="
# Проверяем типичные IP для принтеров
for ip in 192.168.14.100 192.168.14.150 192.168.14.200 192.168.14.250; do
    echo -n "Проверяем $ip... "
    ping -c 1 -W 1 $ip > /dev/null 2>&1
    if [ $? -eq 0 ]; then
        echo -n "✅ Отвечает на ping, проверяем порт 9100... "
        nc -z -w 1 $ip 9100 2>/dev/null
        if [ $? -eq 0 ]; then
            echo "✅ Порт открыт!"
        else
            echo "порт закрыт"
        fi
    else
        echo "❌ Не отвечает"
    fi
done

echo ""
echo "=== Рекомендации ==="
echo "1. Проверьте на принтере текущий IP адрес (в меню LAN Settings)"
echo "2. Убедитесь, что сетевой кабель подключен к принтеру"
echo "3. Попробуйте перезагрузить принтер"
echo "4. Если принтер получает IP по DHCP, проверьте роутер для его IP"